; =============================================================
; Supervisor Config for SocialNgin Order Worker
; =============================================================
;
; INSTALLATION (on your production Ubuntu/CentOS server):
;
;   1. Install Supervisor:
;      sudo apt install supervisor
;
;   2. Copy this file:
;      sudo cp order_worker.conf /etc/supervisor/conf.d/order_worker.conf
;
;   3. Update the paths below to match your server setup
;
;   4. Reload Supervisor:
;      sudo supervisorctl reread
;      sudo supervisorctl update
;
;   5. Check status:
;      sudo supervisorctl status order_worker:*
;
;   6. View logs:
;      tail -f /var/log/socialngin/worker.log
;
; =============================================================

[program:order_worker]

; === IMPORTANT: Update these paths to match your server ===
command=php /var/www/socialngin/cli_worker.php
directory=/var/www/socialngin
user=www-data

; === Scaling ===
; Number of worker processes to run in parallel.
; Each worker handles 50 orders concurrently (via Guzzle async).
;   1 worker  = ~90,000  orders/hour
;   3 workers = ~270,000 orders/hour
;   5 workers = ~450,000 orders/hour
numprocs=3
process_name=%(program_name)s_%(process_num)02d

; === Auto-management ===
autostart=true
autorestart=true
startsecs=5
startretries=3

; === Logging ===
stdout_logfile=/var/log/socialngin/worker.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=5
stderr_logfile=/var/log/socialngin/worker_error.log
stderr_logfile_maxbytes=5MB
stderr_logfile_backups=3

; === Graceful shutdown ===
stopwaitsecs=30
stopsignal=SIGTERM
